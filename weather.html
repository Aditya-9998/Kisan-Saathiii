<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Village Weather ‚Äì Multi Language</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f7ff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .app {
      width: 100%;
      max-width: 480px;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin: 0 0 6px;
      font-size: 26px;
      color: #005f99;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      margin-bottom: 10px;
      color: #333;
    }

    /* Language dropdown */
    .lang-select {
      margin-bottom: 14px;
    }

    .lang-select label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
      color: #333;
      font-weight: 600;
    }

    .lang-select select {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #0077cc;
      font-size: 14px;
      background: #ffffff;
      cursor: pointer;
    }

    .card {
      background: white;
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 14px;
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .input-row input {
      flex: 1;
      padding: 12px;
      font-size: 14px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    .btn {
      padding: 12px;
      font-size: 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: #0077cc;
      color: white;
      white-space: nowrap;
    }

    .btn-secondary { background: #00a36c; }

    .btn-block {
      width: 100%;
      margin-top: 8px;
    }

    .status {
      font-size: 12px;
      color: #555;
      margin-top: 4px;
    }

    .alert {
      background: #ffe5e5;
      color: #b30000;
      padding: 8px;
      border-radius: 10px;
      font-size: 14px;
      margin-bottom: 8px;
      display: none;
    }

    .current-main {
      text-align: center;
      position: relative;
      z-index: 2;
      color: #ffffff;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }

    .location-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 4px;
    }

    .current-date {
      font-size: 13px;
      margin-bottom: 6px;
    }

    .temp-big {
      font-size: 40px;
      font-weight: bold;
      margin: 4px 0;
    }

    .condition-text {
      font-size: 16px;
      margin-bottom: 4px;
      text-transform: capitalize;
    }

    .current-extra {
      font-size: 13px;
      margin-top: 2px;
    }

    .two-col {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-top: 6px;
    }

    .forecast-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .forecast-list {
      max-height: 260px;
      overflow-y: auto;
    }

    .day-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      border-radius: 10px;
      background: #e8f4ff;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .day-left { text-align: left; }

    .day-date {
      font-weight: bold;
      margin-bottom: 2px;
    }

    .day-cond {
      font-size: 12px;
      color: #333;
    }

    .day-temp {
      font-size: 16px;
      font-weight: bold;
    }

    .day-rain {
      font-size: 12px;
      color: #005f99;
      text-align: right;
    }

    .speak-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .tip-text {
      font-size: 14px;
      color: #225522;
    }

    .offline-note {
      font-size: 12px;
      color: #555;
      margin-top: 4px;
    }

    @media (max-width: 360px) {
      h1 { font-size: 22px; }
      .temp-big { font-size: 34px; }
    }

    /* ================================
       üå¶ HEAVY ANIMATION ON CURRENT CARD
       ================================*/

    #currentCard {
      position: relative;
      overflow: hidden;
      background: #222;
      color: #fff;
    }

    #currentCard::before,
    #currentCard::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 1;
    }

    /* --- SUNNY (soft, text clearly visible) --- */
    #currentCard.weather-sunny {
      background: linear-gradient(
        180deg,
        #FFFDE5 0%,
        #FFF4C6 45%,
        #FFE8A4 100%
      );
    }

    #currentCard.weather-sunny::before {
      background:
        radial-gradient(circle at 20% 10%, rgba(255,255,255,0.7) 0, transparent 60%),
        radial-gradient(circle at 80% 0%,  rgba(255,255,255,0.5) 0, transparent 65%);
      animation: sunnyRays 4s infinite alternate;
      opacity: 0.75;
    }

    @keyframes sunnyRays {
      0% { transform: scale(1); opacity: 0.7; }
      100% { transform: scale(1.08); opacity: 0.9; }
    }

    /* --- CLOUDY --- */
    #currentCard.weather-cloudy {
      background: linear-gradient(#3d4f60, #222b33);
    }
    #currentCard.weather-cloudy::before {
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.9) 0, transparent 55%),
        radial-gradient(circle at 40% 10%, rgba(255,255,255,0.9) 0, transparent 55%),
        radial-gradient(circle at 80% 25%, rgba(255,255,255,0.8) 0, transparent 55%);
      background-repeat: no-repeat;
      background-size: 180px 100px;
      animation: cloudsMove 18s linear infinite;
      opacity: 0.9;
    }
    @keyframes cloudsMove {
      0% { background-position: -150px 10px, 80px -10px, 300px 20px; }
      100% { background-position: 0px 10px, 230px -10px, 450px 20px; }
    }

    /* --- RAIN --- */
    #currentCard.weather-rain {
      background: radial-gradient(circle at top, #2c3e50, #111822);
    }
    #currentCard.weather-rain::before {
      background-image: linear-gradient(
        to bottom,
        rgba(255,255,255,0.0) 0,
        rgba(173,216,230,0.8) 60%,
        rgba(173,216,230,0.2) 100%
      );
      background-size: 2px 18px;
      background-repeat: repeat;
      animation: rainFall 0.35s linear infinite;
      opacity: 0.95;
    }
    @keyframes rainFall {
      0% { background-position: 0 0; }
      100% { background-position: 0 18px; }
    }
    #currentCard.weather-rain::after {
      background: radial-gradient(circle at top, rgba(255,255,255,0.2), transparent 60%);
    }

    /* --- FOG / COLD --- */
    #currentCard.weather-fog {
      background: linear-gradient(#52606d, #222831);
    }
    #currentCard.weather-fog::before {
      background: rgba(255,255,255,0.55);
      filter: blur(10px);
      transform: translateX(-60%);
      animation: fogDrift 10s linear infinite;
      opacity: 0.8;
    }
    #currentCard.weather-fog::after {
      background: radial-gradient(circle at bottom, rgba(255,255,255,0.5), transparent 60%);
      opacity: 0.6;
    }
    @keyframes fogDrift {
      0% { transform: translateX(-60%); }
      100% { transform: translateX(60%); }
    }

    /* --- STORM --- */
    #currentCard.weather-storm {
      background: radial-gradient(circle at top, #3b3f60, #050716 60%, #000);
    }
    #currentCard.weather-storm::before {
      background-image: linear-gradient(
        to bottom,
        rgba(255,255,255,0.0) 0,
        rgba(173,216,230,0.9) 60%,
        rgba(173,216,230,0.3) 100%
      );
      background-size: 2px 20px;
      background-repeat: repeat;
      animation: rainFall 0.28s linear infinite;
      opacity: 0.85;
    }
    #currentCard.weather-storm::after {
      background: radial-gradient(circle at 30% 0%, rgba(255,255,255,0.9), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0;
      animation: lightningFlash 4s infinite;
    }
    @keyframes lightningFlash {
      0%, 80%, 100% { opacity: 0; }
      81% { opacity: 1; }
      83% { opacity: 0; }
      86% { opacity: 1; }
      88% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>üå¶Ô∏è Village Weather</h1>
    <div class="subtitle" id="subtitle">
      Simple 14-day weather for village people
    </div>

    <!-- Language Dropdown -->
    <div class="lang-select">
      <label for="languageSelect">üåê Language / ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</label>
      <select id="languageSelect">
        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
        <option value="en">English</option>
        <option value="bho">‡§≠‡•ã‡§ú‡§™‡•Å‡§∞‡•Ä (Bhojpuri)</option>
        <option value="mai">‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä (Maithili)</option>
      </select>
    </div>

    <!-- Search & GPS -->
    <div class="card">
      <div class="input-row">
        <input
          id="placeInput"
          type="text"
          placeholder="Apna gaon / city name likhe"
        />
        <button class="btn" id="btnSearch">üîç</button>
      </div>
      <button class="btn btn-secondary btn-block" id="btnLocation">
        üìç Use my location
      </button>
      <div class="status" id="statusText"></div>
    </div>

    <!-- Alert Banner -->
    <div class="alert" id="alertBox"></div>

    <!-- Current Weather Card WITH ANIMATION -->
    <div class="card" id="currentCard" style="display:none;">
      <div class="current-main">
        <div class="location-name" id="locationName"></div>
        <div class="current-date" id="currentDate"></div>
        <div class="temp-big" id="currentTemp"></div>
        <div class="condition-text" id="conditionText"></div>
        <div class="current-extra" id="extraText"></div>
        <div class="two-col">
          <div id="rangeText"></div>
          <div id="sunText"></div>
        </div>
      </div>
      <div class="speak-row">
        <button class="btn btn-block" id="btnSpeakToday">üîä Speak Today</button>
        <button class="btn btn-block" id="btnSpeakSummary">
          üó£Ô∏è Speak 14 Days
        </button>
      </div>
    </div>

    <!-- Forecast Card -->
    <div class="card" id="forecastCard" style="display:none;">
      <div class="forecast-title" id="forecastTitle">14-Day Forecast</div>
      <div class="forecast-list" id="forecastList"></div>
    </div>

    <!-- Farming Tip Card -->
    <div class="card" id="tipCard" style="display:none;">
      <strong id="tipTitle">Farming Tip</strong>
      <div class="tip-text" id="tipText"></div>
      <div class="offline-note" id="offlineNote">
        Last weather is saved. You can see it even without internet.
      </div>
    </div>
  </div>

  <script>
    // --------- Language Texts ---------
    const texts = {
      hi: {
        subtitle: "‡§ó‡§æ‡§Å‡§µ ‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§∏‡§æ‡§® 14 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ",
        placeholder: "‡§Ö‡§™‡§®‡§æ ‡§ó‡§æ‡§Å‡§µ / ‡§∂‡§π‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç",
        useLocation: "üìç ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§¶‡•á‡§ñ‡•á‡§Ç",
        statusIdle: "‡§ä‡§™‡§∞ ‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç ‡§Ø‡§æ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡•á ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
        searching: "‡§∞‡•Å‡§ï‡§ø‡§è... ‡§Æ‡•å‡§∏‡§Æ ‡§ñ‡•ã‡§ú‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
        usingLocation: "‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§≤‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
        notFound: "‡§ó‡§æ‡§Å‡§µ/‡§∂‡§π‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ, ‡§∏‡§π‡•Ä ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§",
        geoError: "‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§™‡§æ‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç‡•§",
        forecastTitle: "14 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ",
        farmingTipTitle: "‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§≤‡§æ‡§π",
        offlineNote:
          "‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§¶‡•á‡§ñ‡§æ ‡§π‡•Å‡§Ü ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•á‡§µ ‡§π‡•à‡•§ ‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§® ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≠‡•Ä ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§",
        speakTodayLabel: "üîä ‡§Ü‡§ú ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•á‡§Ç",
        speakSummaryLabel: "üó£Ô∏è 14 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•á‡§Ç",
        rainAlertHeavy:
          "‚ö†Ô∏è ‡§§‡•á‡§ú ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§Ø‡§æ ‡§Ü‡§Ç‡§ß‡•Ä ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•à‡•§ ‡§¨‡§æ‡§π‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§∏‡§æ‡§µ‡§ß‡§æ‡§® ‡§∞‡§π‡•á‡§Ç‡•§",
        rainAlertNormal:
          "‚òî ‡§Ü‡§ú ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•à, ‡§´‡§∏‡§≤ ‡§î‡§∞ ‡§™‡§∂‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§ñ‡•á‡§Ç‡•§",
        noAlert: "",
        tipHotDry:
          "‡§Ü‡§ú ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§π‡•à ‡§î‡§∞ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡§Æ ‡§π‡•à‡•§ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§®‡§Æ‡•Ä ‡§¨‡§ö‡§æ‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§",
        tipRainy:
          "‡§Ü‡§ú ‡§Ø‡§æ ‡§Ü‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§π‡•à‡•§ ‡§™‡§æ‡§®‡•Ä ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ï‡§æ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡§ñ‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§®‡•Ä ‡§® ‡§≠‡§∞‡•á‡•§",
        tipNormal:
          "‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à‡•§ ‡§Ü‡§ú ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ñ‡•á‡§§‡•Ä ‡§ï‡§æ ‡§ï‡§æ‡§Æ ‡§Ü‡§∞‡§æ‡§Æ ‡§∏‡•á ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§",
        currentSummary: (loc, max, min, cond, rain) =>
          `${loc} ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§ï‡§æ ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${max} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${min} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ‡•§ ‡§Æ‡•å‡§∏‡§Æ ${cond} ‡§∞‡§π‡•á‡§ó‡§æ‡•§ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§≤‡§ó‡§≠‡§ó ${rain} ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§ ‡§π‡•à‡•§`,
        summary14: (loc, maxArr, minArr) => {
          const firstMax = maxArr[0];
          const firstMin = minArr[0];
          const lastMax = maxArr[maxArr.length - 1];
          const lastMin = minArr[minArr.length - 1];
          return `${loc} ‡§ï‡•á ‡§≤‡§ø‡§è 14 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡•§ ‡§™‡§π‡§≤‡•á ‡§¶‡§ø‡§® ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${firstMax} ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${firstMin} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§Ü‡§∏-‡§™‡§æ‡§∏ ‡§∞‡§π‡•á‡§ó‡§æ‡•§ ‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§¶‡§ø‡§® ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§≤‡§ó‡§≠‡§ó ${lastMax} ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${lastMin} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§∞‡§π‡§®‡•á ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•à‡•§`;
        },
        conditionName: {
          clear: "‡§ñ‡•Å‡§≤‡§æ ‡§Ü‡§∏‡§Æ‡§æ‡§®",
          cloudy: "‡§¨‡§æ‡§¶‡§≤",
          rain: "‡§¨‡§æ‡§∞‡§ø‡§∂",
          storm: "‡§Ü‡§Ç‡§ß‡•Ä-‡§§‡•Ç‡§´‡§æ‡§®",
          snow: "‡§¨‡§∞‡•ç‡§´‡§¨‡§æ‡§∞‡•Ä",
          drizzle: "‡§π‡§≤‡•ç‡§ï‡•Ä ‡§´‡•Å‡§π‡§æ‡§∞‡•á‡§Ç",
          fog: "‡§ï‡•ã‡§π‡§∞‡§æ"
        }
      },
      en: {
        subtitle: "Simple 14-day weather for village people",
        placeholder: "Type your village / city name",
        useLocation: "üìç Use my location",
        statusIdle: "Type village name above or use location.",
        searching: "Please wait... fetching weather...",
        usingLocation: "Getting your location...",
        notFound: "Place not found. Please check the spelling.",
        geoError: "Could not get your location. Please search by name.",
        forecastTitle: "14-Day Forecast",
        farmingTipTitle: "Farming Tip",
        offlineNote:
          "Last seen weather is saved. You can see it without internet.",
        speakTodayLabel: "üîä Speak Today",
        speakSummaryLabel: "üó£Ô∏è Speak 14 Days",
        rainAlertHeavy:
          "‚ö†Ô∏è Heavy rain or storm expected. Be careful while working outside.",
        rainAlertNormal:
          "‚òî Good chance of rain today. Keep crops and animals safe.",
        noAlert: "",
        tipHotDry:
          "It is hot and dry today. Water your crops on time and keep soil moisture.",
        tipRainy:
          "Good rain today or in coming days. Take care of drainage so fields do not flood.",
        tipNormal:
          "Weather is normal. You can do regular farming work comfortably.",
        currentSummary: (loc, max, min, cond, rain) =>
          `In ${loc}, today's maximum temperature will be around ${max} degrees and minimum around ${min} degrees. Weather will be ${cond}. Chance of rain is about ${rain} percent.`,
        summary14: (loc, maxArr, minArr) => {
          const firstMax = maxArr[0];
          const firstMin = minArr[0];
          const lastMax = maxArr[maxArr.length - 1];
          const lastMin = minArr[minArr.length - 1];
          return `14-day forecast ready for ${loc}. On the first day, max temperature is about ${firstMax} and min about ${firstMin} degrees. On the last day, max is about ${lastMax} and min about ${lastMin} degrees.`;
        },
        conditionName: {
          clear: "clear sky",
          cloudy: "cloudy",
          rain: "rainy",
          storm: "stormy",
          snow: "snowy",
          drizzle: "light drizzle",
          fog: "fog"
        }
      },
      bho: {
        subtitle: "‡§ó‡§æ‡§Å‡§µ ‡§µ‡§æ‡§≤‡§æ ‡§≤‡•ã‡§ó ‡§ñ‡§æ‡§§‡§ø‡§∞ ‡§Ü‡§∏‡§æ‡§® 14 ‡§¶‡§ø‡§® ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ",
        placeholder: "‡§Ü‡§™‡§® ‡§ó‡§æ‡§Å‡§µ / ‡§∏‡§π‡§∞ ‡§ï‡•á ‡§®‡§æ‡§µ ‡§≤‡§ø‡§ñ‡•Ä‡§Ç",
        useLocation: "üìç ‡§Ü‡§™‡§® ‡§ú‡§ó‡§π ‡§∏‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§¶‡•á‡§ñ‡•Ä‡§Ç",
        statusIdle: "‡§ä‡§™‡§∞ ‡§ó‡§æ‡§Å‡§µ ‡§ï‡•á ‡§®‡§æ‡§µ ‡§≤‡§ø‡§ñ‡•Ä‡§Ç ‡§ö‡§æ‡§π‡•á ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡•á ‡§¶‡•á‡§ñ‡•Ä‡§Ç‡•§",
        searching: "‡§∞‡•Å‡§ï‡§π‡•Ä‡§Ç... ‡§Æ‡•å‡§∏‡§Æ ‡§®‡§ø‡§ï‡§æ‡§≤‡•á ‡§ú‡§æ ‡§∞‡§π‡§≤ ‡§¨‡§æ...",
        usingLocation: "‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§≤‡•á‡§π‡§≤ ‡§ú‡§æ ‡§∞‡§π‡§≤ ‡§¨‡§æ...",
        notFound: "‡§ó‡§æ‡§Å‡§µ / ‡§∏‡§π‡§∞ ‡§®‡§æ ‡§Æ‡§ø‡§≤‡§≤, ‡§∏‡§π‡•Ä ‡§®‡§æ‡§µ ‡§∏‡•á ‡§´‡•á‡§∞ ‡§≤‡§ø‡§ñ‡•Ä‡§Ç‡•§",
        geoError: "‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§®‡§æ ‡§Æ‡§ø‡§≤ ‡§™‡§æ‡§µ‡§≤‡•§ ‡§ï‡§ø‡§∞‡§™‡§æ ‡§ï‡§ï‡•á ‡§®‡§æ‡§µ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•Ä‡§Ç‡•§",
        forecastTitle: "14 ‡§¶‡§ø‡§® ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ",
        farmingTipTitle: "‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§≤‡§æ‡§π",
        offlineNote:
          "‡§™‡§ø‡§õ‡§≤‡§æ ‡§¶‡•á‡§ñ‡§≤ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•á‡§µ ‡§¨‡§æ, ‡§¨‡§ø‡§®‡§æ ‡§®‡•á‡§ü ‡§≠‡•Ä ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§ ‡§¨‡§æ‡§®‡•Ä‡•§",
        speakTodayLabel: "üîä ‡§Ü‡§ú ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•Ä‡§Ç",
        speakSummaryLabel: "üó£Ô∏è 14 ‡§¶‡§ø‡§® ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•Ä‡§Ç",
        rainAlertHeavy:
          "‚ö†Ô∏è ‡§Ü‡§ú ‡§§‡•á‡§ú ‡§¨‡§∞‡§ñ‡§æ ‡§Ü‡§Ç‡§ß‡•Ä ‡§ï‡•á ‡§Ü‡§∏‡§æ‡§∞ ‡§¨‡§æ‡•§ ‡§¨‡§æ‡§π‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§ ‡§¨‡•á‡§∞‡§æ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§® ‡§∞‡§π‡•Ä‡§Ç‡•§",
        rainAlertNormal:
          "‚òî ‡§Ü‡§ú ‡§¨‡§∞‡§ñ‡§æ ‡§ï‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Æ‡•å‡§ï‡§æ ‡§¨‡§æ, ‡§´‡§∏‡§≤ ‡§Ü ‡§ú‡§æ‡§®‡§µ‡§∞ ‡§ï‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ú‡§ó‡§π ‡§™‡§∞ ‡§∞‡§æ‡§ñ‡•Ä‡§Ç‡•§",
        noAlert: "",
        tipHotDry:
          "‡§Ü‡§ú ‡§ó‡§∞‡§Æ‡•Ä ‡§ú‡§æ‡§¶‡•á ‡§¨‡§æ ‡§Ü ‡§¨‡§∞‡§ñ‡§æ ‡§ï‡§Æ ‡§¨‡§æ‡•§ ‡§¨‡•á‡§∞‡§æ ‡§™‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§¶‡•Ä‡§π‡•Ä‡§Ç ‡§Ü ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§®‡§Æ‡•Ä ‡§¨‡§ö‡§æ ‡§ï‡•á ‡§∞‡§ñ‡•Ä‡§Ç‡•§",
        tipRainy:
          "‡§Ü‡§ú ‡§®‡§æ ‡§§ ‡§Ü‡§µ‡•á ‡§µ‡§æ‡§≤‡§æ ‡§¶‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ ‡§¨‡§∞‡§ñ‡§æ ‡§¨‡§æ‡•§ ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§®‡•Ä ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§†‡•Ä‡§ï ‡§∞‡§æ‡§ñ‡•Ä‡§Ç, ‡§ú‡•á‡§ï‡§∞‡•á ‡§∏‡•á ‡§™‡§æ‡§®‡•Ä ‡§ú‡§Æ‡§æ ‡§®‡§æ ‡§π‡•ã‡§ñ‡•á‡•§",
        tipNormal:
          "‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§¨‡§æ‡•§ ‡§Ü‡§ú ‡§Ü‡§∞‡§æ‡§Æ ‡§∏‡•á ‡§Ü‡§™‡§® ‡§ñ‡•á‡§§‡•Ä-‡§ï‡§∞‡•Ä ‡§ï‡§∞ ‡§∏‡§ï‡§§ ‡§¨‡§æ‡§®‡•Ä‡•§",
        currentSummary: (loc, max, min, cond, rain) =>
          `${loc} ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§ï‡•á ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§ï‡§∞‡•Ä‡§¨ ${max} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§Ü ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${min} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§∞‡§π‡•Ä‡•§ ‡§Æ‡•å‡§∏‡§Æ ${cond} ‡§ú‡§á‡§∏‡§® ‡§∞‡§π‡•Ä‡•§ ‡§¨‡§∞‡§ñ‡§æ ‡§ï‡•á ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡§∞‡•Ä‡§¨ ${rain} ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§ ‡§¨‡§æ‡•§`,
        summary14: (loc, maxArr, minArr) => {
          const firstMax = maxArr[0];
          const firstMin = minArr[0];
          const lastMax = maxArr[maxArr.length - 1];
          const lastMin = minArr[minArr.length - 1];
          return `${loc} ‡§ñ‡§æ‡§§‡§ø‡§∞ 14 ‡§¶‡§ø‡§® ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§§‡§Ø‡§æ‡§∞ ‡§¨‡§æ‡•§ ‡§™‡§π‡§ø‡§≤‡•á ‡§¶‡§ø‡§® ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§ï‡§∞‡•Ä‡§¨ ${firstMax} ‡§Ü ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${firstMin} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§∞‡§π‡•Ä, ‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§¶‡§ø‡§® ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ${lastMax} ‡§Ü ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${lastMin} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§∞‡§π‡•á ‡§ï‡•á ‡§â‡§Æ‡•á‡§¶ ‡§¨‡§æ‡•§`;
        },
        conditionName: {
          clear: "‡§ñ‡•Å‡§≤‡§æ ‡§Ü‡§∏‡§Æ‡§æ‡§®",
          cloudy: "‡§¨‡§æ‡§¶‡§∞ ‡§≤‡§æ‡§ó‡§≤",
          rain: "‡§¨‡§∞‡§ñ‡§æ",
          storm: "‡§Ü‡§Ç‡§ß‡•Ä-‡§§‡•Ç‡§´‡§æ‡§®",
          snow: "‡§¨‡§∞‡§´‡§¨‡§æ‡§∞‡•Ä",
          drizzle: "‡§π‡§≤‡•ç‡§ï‡§æ ‡§´‡•Å‡§π‡§æ‡§∞",
          fog: "‡§ï‡•ã‡§π‡§∞‡§æ"
        }
      },
      mai: {
        subtitle: "‡§ó‡§æ‡§Å‡§µ‡§ï ‡§Æ‡§®‡•Å‡§ñ ‡§≤‡•á‡§≤ ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ 14 ‡§¶‡§ø‡§®‡§ï ‡§Æ‡•å‡§∏‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
        placeholder: "‡§Ö‡§™‡§® ‡§ó‡§æ‡§Æ / ‡§∂‡§π‡§∞‡§ï ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•Ç",
        useLocation: "üìç ‡§Ö‡§™‡§® ‡§ú‡§ó‡§π ‡§∏‡§Å ‡§Æ‡•å‡§∏‡§Æ ‡§¶‡•á‡§ñ‡•Ç",
        statusIdle: "‡§â‡§™‡•ç‡§™‡§∞ ‡§ó‡§æ‡§Æ‡§ï ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•Ç ‡§Ø‡§æ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡§Å ‡§¶‡•á‡§ñ‡•Ç‡•§",
        searching: "‡§∞‡•Å‡§ï‡•Ç... ‡§Æ‡•å‡§∏‡§Æ ‡§®‡§ø‡§ï‡§æ‡§≤‡§≤ ‡§ú‡§æ‡§è‡§§ ‡§Ö‡§õ‡§ø...",
        usingLocation: "‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§≤ ‡§≤‡•á‡§≤ ‡§ú‡§æ‡§è‡§§ ‡§Ö‡§õ‡§ø...",
        notFound: "‡§ó‡§æ‡§Æ / ‡§∂‡§π‡§∞ ‡§®‡§π‡§ø ‡§≠‡•á‡§ü‡§≤, ‡§∏‡§π‡•Ä ‡§®‡§æ‡§Æ ‡§∏‡§Å ‡§™‡•Å‡§®‡•ç‡§π ‡§≤‡§ø‡§ñ‡•Ç‡•§",
        geoError: "‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§®‡§π‡§ø ‡§≠‡•á‡§ü‡§ø ‡§∏‡§ï‡§≤‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§∏‡§Å ‡§ñ‡•ã‡§ú‡•Ç‡•§",
        forecastTitle: "14 ‡§¶‡§ø‡§®‡§ï ‡§Æ‡•å‡§∏‡§Æ",
        farmingTipTitle: "‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡§≤‡§æ‡§π",
        offlineNote:
          "‡§Ö‡§ñ‡•á‡§∞‡•Ä ‡§¨‡•á‡§∞ ‡§¶‡•á‡§ñ‡§≤ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•á‡§µ ‡§Ö‡§õ‡§ø, ‡§¨‡§ø‡§®‡•Å ‡§®‡•á‡§ü‡•ã ‡§¶‡•á‡§ñ‡§ø ‡§∏‡§ï‡§á‡§§ ‡§õ‡•Ä‡•§",
        speakTodayLabel: "üîä ‡§Ü‡§á‡§ï ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•Ç",
        speakSummaryLabel: "üó£Ô∏è 14 ‡§¶‡§ø‡§®‡§ï ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•Ç",
        rainAlertHeavy:
          "‚ö†Ô∏è ‡§Ü‡§á ‡§ú‡•ã‡§∞‡§¶‡§æ‡§∞ ‡§¨‡§∞‡§ñ‡§æ ‡§Ü ‡§Ü‡§Å‡§ß‡•Ä‡§ï ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§Ö‡§õ‡§ø‡•§ ‡§¨‡§æ‡§π‡§∞‡•á ‡§ï‡§æ‡§ú ‡§ï‡§∞‡•à‡§§ ‡§∏‡§Æ‡§Ø ‡§∏‡§æ‡§µ‡§ß‡§æ‡§® ‡§∞‡§π‡•Ç‡•§",
        rainAlertNormal:
          "‚òî ‡§Ü‡§á ‡§®‡•Ä‡§ï ‡§¨‡§∞‡§ñ‡§æ ‡§≠ ‡§∏‡§ï‡•à‡§§ ‡§Ö‡§õ‡§ø, ‡§´‡§∏‡§≤ ‡§Ü ‡§ú‡§®‡§æ‡§µ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ú‡§ó‡§π ‡§™‡§∞ ‡§∞‡§æ‡§ñ‡•Ç‡•§",
        noAlert: "",
        tipHotDry:
          "‡§Ü‡§á ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§¨‡•á‡§∏‡•Ä ‡§Ö‡§õ‡§ø ‡§Ü ‡§¨‡§∞‡§ñ‡§æ ‡§ï‡§Æ ‡§Ö‡§õ‡§ø‡•§ ‡§∏‡§Æ‡§Ø ‡§∏‡§Å ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§∞‡•Ç ‡§Ü ‡§ñ‡•á‡§§‡§Æ‡•á ‡§®‡§Æ‡•Ä ‡§¨‡§ö‡§æ ‡§ï‡§è ‡§∞‡§ñ‡•Ç‡•§",
        tipRainy:
          "‡§Ü‡§á ‡§Ö‡§•‡§µ‡§æ ‡§Ü‡§ó‡§æ‡§Å‡§ï ‡§¶‡§ø‡§®‡§Æ‡•á ‡§®‡•Ä‡§ï ‡§¨‡§∞‡§ñ‡§æ ‡§Ö‡§õ‡§ø‡•§ ‡§ñ‡•á‡§§‡§Æ‡•á ‡§™‡§æ‡§®‡•Ä ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡§æ‡§ñ‡•Ç ‡§ú‡•á‡§®‡§æ ‡§™‡§æ‡§®‡§ø ‡§≠‡§∞‡§ø ‡§®‡§π‡§ø ‡§ú‡§æ‡§Ø‡•§",
        tipNormal:
          "‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Ö‡§õ‡§ø‡•§ ‡§Ö‡§™‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ü‡§∞‡§æ‡§Æ ‡§∏‡§Å ‡§ñ‡•á‡§§‡•Ä‡§ï ‡§ï‡§æ‡§ú ‡§ï‡§∞‡•Ç‡•§",
        currentSummary: (loc, max, min, cond, rain) =>
          `${loc} ‡§Æ‡•á ‡§Ü‡§á ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§ï‡§∞‡•Ä‡§¨ ${max} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§Ü ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${min} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§∞‡§π‡§§‡•§ ‡§Æ‡•å‡§∏‡§Æ ${cond} ‡§ú‡§ï‡§æ‡§Å ‡§∞‡§π‡§§‡•§ ‡§¨‡§∞‡§ñ‡§æ‡•á‡§ï ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡§∞‡•Ä‡§¨ ${rain} ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§ ‡§Ö‡§õ‡§ø‡•§`,
        summary14: (loc, maxArr, minArr) => {
          const firstMax = maxArr[0];
          const firstMin = minArr[0];
          const lastMax = maxArr[maxArr.length - 1];
          const lastMin = minArr[minArr.length - 1];
          return `${loc} ‡§≤‡•á‡§≤ 14 ‡§¶‡§ø‡§®‡§ï ‡§Æ‡•å‡§∏‡§Æ ‡§§‡§Ø‡§æ‡§∞ ‡§Ö‡§õ‡§ø‡•§ ‡§™‡§π‡§ø‡§≤‡§¶‡§ø‡§® ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${firstMax} ‡§Ü ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${firstMin} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä‡§ï ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§∞‡§π‡§§, ‡§Ü ‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§¶‡§ø‡§® ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ${lastMax} ‡§Ü ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${lastMin} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§π‡•ã‡§è‡§¨‡§æ‡§ï ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§Ö‡§õ‡§ø‡•§`;
        },
        conditionName: {
          clear: "‡§ñ‡•Å‡§≤‡•ç‡§≤‡§æ ‡§Ü‡§ï‡§æ‡§∂",
          cloudy: "‡§¨‡§æ‡§¶‡§≤ ‡§õ‡§≤‡•à‡§≤",
          rain: "‡§¨‡§∞‡§ñ‡§æ",
          storm: "‡§Ü‡§Å‡§ß‡•Ä-‡§§‡•Ç‡§´‡§æ‡§®",
          snow: "‡§¨‡§∞‡§´‡§¨‡§æ‡§∞‡•Ä",
          drizzle: "‡§π‡§≤‡•ç‡§ï‡§æ ‡§´‡•Å‡§π‡§æ‡§∞",
          fog: "‡§ï‡•ã‡§π‡§∞‡§æ"
        }
      }
    };

    let currentLang = "hi";
    let lastWeatherData = null;
    let lastMeta = null;

    function setLanguage(lang) {
      currentLang = lang;
      const t = texts[lang];

      document.getElementById("subtitle").textContent = t.subtitle;
      document.getElementById("placeInput").placeholder = t.placeholder;
      document.getElementById("btnLocation").textContent = t.useLocation;
      document.getElementById("forecastTitle").textContent = t.forecastTitle;
      document.getElementById("tipTitle").textContent = t.farmingTipTitle;
      document.getElementById("offlineNote").textContent = t.offlineNote;
      document.getElementById("btnSpeakToday").textContent = t.speakTodayLabel;
      document.getElementById("btnSpeakSummary").textContent =
        t.speakSummaryLabel;

      if (document.getElementById("statusText").textContent === "" ||
          document.getElementById("statusText").textContent === texts.hi.statusIdle ||
          document.getElementById("statusText").textContent === texts.en.statusIdle) {
        document.getElementById("statusText").textContent = t.statusIdle;
      }

      if (lastWeatherData && lastMeta) {
        renderWeather(lastWeatherData, lastMeta);
      }
    }

    function formatDate(dateStr) {
      const d = new Date(dateStr);
      const day = d.getDate().toString().padStart(2, "0");
      const month = (d.getMonth() + 1).toString().padStart(2, "0");
      return `${day}-${month}`;
    }

    function mapWeatherCodeToType(code) {
      if (code === 0) return "clear";
      if ([1, 2, 3].includes(code)) return "cloudy";
      if ([51, 53, 55, 61, 63, 65, 66, 67, 80, 81, 82].includes(code))
        return "rain";
      if ([95, 96, 99].includes(code)) return "storm";
      if ([71, 73, 75, 77, 85, 86].includes(code)) return "snow";
      if ([45, 48].includes(code)) return "fog";
      if ([56, 57].includes(code)) return "drizzle";
      return "cloudy";
    }

    function getConditionLabel(type) {
      const labelMap = texts[currentLang].conditionName;
      return labelMap[type] || type;
    }

    function buildAlert(rainProb, code) {
      const t = texts[currentLang];
      const type = mapWeatherCodeToType(code);
      if (type === "storm" || rainProb >= 80) {
        return t.rainAlertHeavy;
      }
      if (rainProb >= 50) {
        return t.rainAlertNormal;
      }
      return t.noAlert;
    }

    function buildFarmingTip(maxTemp, rainProb) {
      const t = texts[currentLang];
      if (maxTemp >= 35 && rainProb < 40) {
        return t.tipHotDry;
      }
      if (rainProb >= 60) {
        return t.tipRainy;
      }
      return t.tipNormal;
    }

    function speak(text) {
      if (!window.speechSynthesis) return;
      const utter = new SpeechSynthesisUtterance(text);
      // Hindi engine for hi / bho / mai, English engine for en
      utter.lang = currentLang === "en" ? "en-IN" : "hi-IN";
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function saveOffline(data, meta) {
      try {
        localStorage.setItem(
          "villageWeatherData",
          JSON.stringify({ data, meta, at: Date.now() })
        );
      } catch (_) {}
    }

    function loadOffline() {
      try {
        const raw = localStorage.getItem("villageWeatherData");
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (_) {
        return null;
      }
    }

    function applyCardAnimation(type) {
      const card = document.getElementById("currentCard");
      card.classList.remove(
        "weather-sunny",
        "weather-rain",
        "weather-cloudy",
        "weather-fog",
        "weather-storm"
      );

      if (type === "clear") card.classList.add("weather-sunny");
      else if (type === "rain" || type === "drizzle")
        card.classList.add("weather-rain");
      else if (type === "storm") card.classList.add("weather-storm");
      else if (type === "fog" || type === "snow")
        card.classList.add("weather-fog");
      else card.classList.add("weather-cloudy");
    }

    // --------- Rendering ---------
    function renderWeather(apiData, meta) {
      lastWeatherData = apiData;
      lastMeta = meta;

      const t = texts[currentLang];
      const current = apiData.current_weather;
      const daily = apiData.daily;

      const currentCard = document.getElementById("currentCard");
      currentCard.style.display = "block";
      document.getElementById("forecastCard").style.display = "block";
      document.getElementById("tipCard").style.display = "block";

      const locationName = meta.placeName || "Your Place";

      const todayIndex = 0;
      const todayMax = Math.round(daily.temperature_2m_max[todayIndex]);
      const todayMin = Math.round(daily.temperature_2m_min[todayIndex]);
      const todayRainProb = daily.precipitation_probability_max[todayIndex];
      const todayCode = daily.weathercode[todayIndex];
      const type = mapWeatherCodeToType(todayCode);
      const condLabel = getConditionLabel(type);

      const todayDate = new Date(daily.time[todayIndex]);
      const dateStr = todayDate.toLocaleDateString(
        currentLang === "en" ? "en-IN" : "hi-IN",
        { weekday: "short", day: "numeric", month: "short" }
      );

      document.getElementById("locationName").textContent = locationName;
      document.getElementById("currentDate").textContent = dateStr;
      document.getElementById("currentTemp").textContent =
        Math.round(current.temperature) + "¬∞C";
      document.getElementById("conditionText").textContent = condLabel;
      document.getElementById("extraText").textContent =
        currentLang === "en"
          ? `Wind speed ${current.windspeed} km/h`
          : currentLang === "bho"
          ? `‡§π‡§µ‡§æ ‡§ï‡•á ‡§∞‡§´‡§§‡§æ‡§∞ ${current.windspeed} km/h`
          : currentLang === "mai"
          ? `‡§π‡§æ‡§µ‡§æ‡§ï ‡§∞‡§´‡•ç‡§§‡§æ‡§∞ ${current.windspeed} km/h`
          : `‡§π‡§µ‡§æ ‡§ï‡•Ä ‡§∞‡§´‡§º‡•ç‡§§‡§æ‡§∞ ${current.windspeed} km/h`;

      document.getElementById("rangeText").textContent =
        todayMax + "¬∞ / " + todayMin + "¬∞";

      const sunrise = daily.sunrise[todayIndex].split("T")[1]?.slice(0, 5);
      const sunset = daily.sunset[todayIndex].split("T")[1]?.slice(0, 5);

      let sunText;
      if (currentLang === "en") {
        sunText = `Sunrise ${sunrise}, Sunset ${sunset}`;
      } else if (currentLang === "bho") {
        sunText = `‡§∏‡•Ç‡§∞‡§ú ‡§â‡§ó‡§≤‡§æ ${sunrise}, ‡§Ö‡§∏‡•ç‡§§ ${sunset} ‡§¨‡§ú‡•á`;
      } else if (currentLang === "mai") {
        sunText = `‡§∏‡•Ç‡§∞‡•ç‡§Ø‡•ã‡§¶‡§Ø ${sunrise}, ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§ ${sunset}`;
      } else {
        sunText = `‡§∏‡•Ç‡§∞‡•ç‡§Ø‡•ã‡§¶‡§Ø ${sunrise}, ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§ ${sunset}`;
      }
      document.getElementById("sunText").textContent = sunText;

      applyCardAnimation(type);

      const alertMsg = buildAlert(todayRainProb, todayCode);
      const alertBox = document.getElementById("alertBox");
      if (alertMsg) {
        alertBox.style.display = "block";
        alertBox.textContent = alertMsg;
      } else {
        alertBox.style.display = "none";
      }

      const listEl = document.getElementById("forecastList");
      listEl.innerHTML = "";
      for (let i = 0; i < daily.time.length; i++) {
        const dateLabel =
          i === 0
            ? currentLang === "en"
              ? "Today"
              : currentLang === "bho"
              ? "‡§Ü‡§ú"
              : currentLang === "mai"
              ? "‡§Ü‡§á"
              : "‡§Ü‡§ú"
            : formatDate(daily.time[i]);

        const maxT = Math.round(daily.temperature_2m_max[i]);
        const minT = Math.round(daily.temperature_2m_min[i]);
        const rainP = daily.precipitation_probability_max[i];
        const wType = mapWeatherCodeToType(daily.weathercode[i]);
        const wLabel = getConditionLabel(wType);

        const rainLabel =
          currentLang === "en"
            ? "Rain:"
            : currentLang === "bho"
            ? "‡§¨‡§∞‡§ñ‡§æ:"
            : "‡§¨‡§æ‡§∞‡§ø‡§∂:";

        const item = document.createElement("div");
        item.className = "day-item";
        item.innerHTML = `
          <div class="day-left">
            <div class="day-date">${dateLabel}</div>
            <div class="day-cond">${wLabel}</div>
          </div>
          <div>
            <div class="day-temp">${maxT}¬∞ / ${minT}¬∞</div>
            <div class="day-rain">
              ${rainLabel} ${rainP}%
            </div>
          </div>
        `;
        listEl.appendChild(item);
      }

      const tip = buildFarmingTip(todayMax, todayRainProb);
      document.getElementById("tipText").textContent = tip;

      document.getElementById("statusText").textContent = "";
    }

    // --------- API Calls ---------
    async function fetchWeatherByName(name) {
      const t = texts[currentLang];
      document.getElementById("statusText").textContent = t.searching;

      try {
        const geoResp = await fetch(
          `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(
            name
          )}&count=1&language=en&format=json`
        );
        const geo = await geoResp.json();
        if (!geo.results || !geo.results.length) {
          document.getElementById("statusText").textContent = t.notFound;
          return;
        }
        const place = geo.results[0];
        await fetchWeatherByCoords(
          place.latitude,
          place.longitude,
          `${place.name}, ${place.country}`
        );
      } catch (e) {
        document.getElementById("statusText").textContent = t.notFound;
      }
    }

    async function fetchWeatherByCoords(lat, lon, placeName = "") {
      const t = texts[currentLang];
      document.getElementById("statusText").textContent = t.searching;

      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset&current_weather=true&timezone=auto&forecast_days=14`;

      try {
        const resp = await fetch(url);
        const data = await resp.json();
        const meta = { placeName, lat, lon };
        renderWeather(data, meta);
        saveOffline(data, meta);
      } catch (e) {
        document.getElementById("statusText").textContent = "Error fetching.";
      }
    }

    function useMyLocation() {
      const t = texts[currentLang];
      if (!navigator.geolocation) {
        document.getElementById("statusText").textContent = t.geoError;
        return;
      }
      document.getElementById("statusText").textContent = t.usingLocation;
      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          let placeName =
            currentLang === "en"
              ? "Your Place"
              : currentLang === "bho"
              ? "‡§§‡•ã‡§π‡§æ‡§∞ ‡§á‡§≤‡§æ‡§ï‡§æ"
              : currentLang === "mai"
              ? "‡§Ö‡§π‡§æ‡§Å‡§ï ‡§ú‡§ó‡§π"
              : "‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞";
          try {
            const geoResp = await fetch(
              `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&count=1&language=en&format=json`
            );
            const geo = await geoResp.json();
            if (geo.results && geo.results.length) {
              const p = geo.results[0];
              placeName = `${p.name}, ${p.country}`;
            }
          } catch (_) {}
          fetchWeatherByCoords(lat, lon, placeName);
        },
        () => {
          document.getElementById("statusText").textContent = t.geoError;
        }
      );
    }

    // --------- Voice Buttons ---------
    function speakTodayWeather() {
      if (!lastWeatherData || !lastMeta) return;
      const t = texts[currentLang];
      const daily = lastWeatherData.daily;
      const todayIndex = 0;

      let loc =
        lastMeta.placeName ||
        (currentLang === "en"
          ? "your area"
          : currentLang === "bho"
          ? "‡§∞‡§â‡§µ‡§æ ‡§á‡§≤‡§æ‡§ï‡§æ"
          : currentLang === "mai"
          ? "‡§Ö‡§π‡§æ‡§Å‡§ï ‡§á‡§≤‡§æ‡§ï‡§æ"
          : "‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞");
      const max = Math.round(daily.temperature_2m_max[todayIndex]);
      const min = Math.round(daily.temperature_2m_min[todayIndex]);
      const rain = daily.precipitation_probability_max[todayIndex];
      const type = mapWeatherCodeToType(daily.weathercode[todayIndex]);
      const condLabel = getConditionLabel(type);

      const text = t.currentSummary(loc, max, min, condLabel, rain);
      speak(text);
    }

    function speakSummary14() {
      if (!lastWeatherData || !lastMeta) return;
      const t = texts[currentLang];
      const daily = lastWeatherData.daily;
      const loc =
        lastMeta.placeName ||
        (currentLang === "en"
          ? "your area"
          : currentLang === "bho"
          ? "‡§∞‡§â‡§µ‡§æ ‡§á‡§≤‡§æ‡§ï‡§æ"
          : currentLang === "mai"
          ? "‡§Ö‡§π‡§æ‡§Å‡§ï ‡§á‡§≤‡§æ‡§ï‡§æ"
          : "‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞");
      const maxArr = daily.temperature_2m_max.map((v) => Math.round(v));
      const minArr = daily.temperature_2m_min.map((v) => Math.round(v));
      const text = t.summary14(loc, maxArr, minArr);
      speak(text);
    }

    // --------- Init ---------
    window.addEventListener("DOMContentLoaded", () => {
      // default Hindi
      setLanguage("hi");
      document.getElementById("languageSelect").value = "hi";

      document
        .getElementById("languageSelect")
        .addEventListener("change", (e) => {
          setLanguage(e.target.value);
        });

      document.getElementById("btnSearch").addEventListener("click", () => {
        const val = document.getElementById("placeInput").value.trim();
        if (!val) return;
        fetchWeatherByName(val);
      });

      document
        .getElementById("placeInput")
        .addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            document.getElementById("btnSearch").click();
          }
        });

      document
        .getElementById("btnLocation")
        .addEventListener("click", useMyLocation);

      document
        .getElementById("btnSpeakToday")
        .addEventListener("click", speakTodayWeather);

      document
        .getElementById("btnSpeakSummary")
        .addEventListener("click", speakSummary14);

      const stored = loadOffline();
      if (stored && stored.data && stored.meta) {
        renderWeather(stored.data, stored.meta);
      } else {
        document.getElementById("statusText").textContent =
          texts[currentLang].statusIdle;
      }
    });
  </script>
</body>
</html>
